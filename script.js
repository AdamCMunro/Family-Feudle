const answerData = '[{ "date": "2024-2-11", "question": "Name something of your wifes you like to wear because its so soft.", "answers": ["Her robe (33)", "Her pajamas (16)", "Her sweater (15)", "Her slippers (11)", "Her T-shirt (9)", "Her coat (5)", "Her nightie (3)", "Her scarf (3)" ]},{ "date": "2024-2-12", "question": "Name something youd hate to have happen while youre taking a bath.", "answers": ["Phone rings (35)", "No hot water (24)", "Doorbell rings (8)", "Get electrocuted (6)", "Power outage (4)", "Slip/fall (4)", "Someone comes in (4)" ]},{ "date": "2024-2-13", "question": "Name a place youd hate to spend even one night.", "answers": ["In-laws home (20)", "Jail/prison (19)", "Hospital (12)", "Office/work (8)", "On the couch (7)", "Campground (7)" ]},{ "date": "2024-2-14", "question": "If Steve Harvey were your neighbor, name something of his you might ask to borrow.", "answers": ["Car (24)", "Suits/clothes (19)", "Money (17)", "Jokes/humor (7)", "Mower/lawn service (5)", "Sugar (5)" ]},{ "date": "2024-2-15", "question": "Name something you associate with camels.", "answers": ["Hump (71)", "Desert (13)", "Cigarettes (5)", "Toe/foot (3)", "Water (3)", "Smell/bad breath (2)" ]},{ "date": "2024-2-16", "question": "Name an American city where they know how to party hard.", "answers": ["New Orleans (31)", "New York (21)", "Las Vegas (19)", "Los Angeles (10)", "Miami (4)", "Chicago (4)" ]},{ "date": "2024-2-17", "question": "In one word, describe the underwear your man is wearing right now.", "answers": ["Boxers (31)", "Tighty-whities (23)", "Briefs (19)", "None (6)", "Torn (5)", "Ugly (5)", "Sexy (3)", "Boring (3)" ]},{ "date": "2024-2-18", "question": "Name a place youd hate to find toenail clippings.", "answers": ["My food/plate (48)", "My bed (36)", "On floor/in rug (6)", "Table/counter (5)", "On couch (2)" ]},{ "date": "2024-2-19", "question": "Name something that parents cant wait for their children to get out of.", "answers": ["The house (36)", "Diapers (35)", "School/college (21)", "Teens/puberty (4)" ]},{ "date": "2024-2-20", "question": "If they made a Judge Judy doll, name something it might come with.", "answers": ["Gavel/mallet (64)", "Big mouth/attitude (15)", "Robe/gown (14)", "Glasses (2)" ]},{ "date": "2024-2-21", "question": "Name something a mother might pick out for her adult son.", "answers": ["Clothes (79)", "A woman/wife (9)", "Furniture (3)", "Groceries/food (2)" ]},{ "date": "2024-2-22", "question": "Name a place you stop going to when youre broke.", "answers": ["Restaurants (32)", "Store/mall (16)", "Bar/nightclub (16)", "Casino (15)", "The movies (8)", "The bank (4)", "Ball game (2)", "Racetrack (3)" ]},{ "date": "2024-2-23", "question": "Name the first thing Steve Harvey would remove if he were in a game of strip poker.", "answers": ["His tie (42)", "His shoes (15)", "His shirt (14)", "His jacket (9)", "His hat (6)", "His mustache (4)", "His watch (3)", "His pants (2)" ]},{ "date": "2024-2-24", "question": "Name an animal that might like to watch the DVD Squirrels Gone Wild.", "answers": ["Dog (39)", "Cat (21)", "Squirrel (21)", "Chipmunk (8)", "Coyote (3)", "Bird/eagle (3)", "Rabbit (2)" ]},{ "date": "2024-2-25", "question": "What would it be hard to do if you accidentally put on superglue instead of lipstick?", "answers": ["Eat (32)", "Talk (32)", "Kiss (25)", "Breathe (8)", "Take it off (2)" ]},{ "date": "2024-2-26", "question": "Name an animal that doesnt have a leg to stand on.", "answers": ["Snake (59)", "Fish/shark/eel (23)", "Whale (5)", "Seal/sea lion (4)", "Dolphin/porpoise (3)", "Snail/slug (3)", "Worm (2)" ]},{ "date": "2024-2-27", "question": "You know a guy is really into you if he kisses your what?", "answers": ["Forehead/head (30)", "Cheek (22)", "Neck (15)", "Lips (14)", "Hand (11)", "Ears (7)" ]},{ "date": "2024-2-28", "question": "Give me a word that rhymes with hustle.", "answers": ["Bustle (73)", "Muscle (15)", "Rustle (9)", "Tussle (3)" ]},{ "date": "2024-2-29", "question": "Name a good musical instrument for someone who is full of hot air.", "answers": ["Tuba (56)", "Trumpet (17)", "Trombone (8)", "Bagpipes (8)", "Saxophone (5)", "Flute (4)" ]},{ "date": "2024-3-1", "question": "If a man speaks seven languages, which one would he use when he wants to sound sexy?", "answers": ["French (60)", "Italian (23)", "English/Cockney (8)", "Spanish (3)", "Body language (2)" ]},{ "date": "2024-3-2", "question": "Name something you stuff just as full as you can get it.", "answers": ["Turkey (39)", "Trash cans (14)", "Christmas stocking (6)", "Suitcase (6)", "Pillow (6)", "Teddy bear (5)", "Purse (5)", "Stomach (4)" ]},{ "date": "2024-3-3", "question": "Tell me a country where you think the men are sexier than American men.", "answers": ["Italy (35)", "France (15)", "Australia (12)", "England (6)", "Spain (6)", "Brazil (4)", "Ireland (4)", "Norway (4)" ]},{ "date": "2024-3-4", "question": "Give me a phrase that starts with the words, Off the...", "answers": ["Off the wall (34)", "Off the hook (29)", "Off the cuff (10)", "Off the record (7)", "Off the chart (6)", "Off the deep end (2)", "Off the rack (2)", "Off the top of your head (2)" ]},{ "date": "2024-3-5", "question": "Name a word a dog understands.", "answers": ["Sit (54)", "Come (11)", "Walk (6)", "Food (6)", "Their name (5)", "Stay (4)", "Fetch (3)", "Treat (2)" ]},{ "date": "2024-3-6", "question": "Name a kind of ball it might feel like a woman is pushing out when she gives birth.", "answers": ["Basketball (49)", "Bowling ball (17)", "Football (8)", "Beach ball (7)", "Soccer ball (6)", "Medicine ball (4)", "Softball (2)" ]},{ "date": "2024-3-7", "question": "Tell me something of yours that you swear is possessed.", "answers": ["Children (16)", "Car (14)", "House (10)", "Pet (10)", "Computer (9)", "Myself (8)", "Cellphone (5)", "Spouse (4)" ]},{ "date": "2024-3-8", "question": "Fill in the blank: My man is a love ____.", "answers": ["Machine (42)", "Bug (14)", "Muffin (10)", "Addict (10)", "Hound (8)", "Magnet (4)", "Boat (3)" ]},{ "date": "2024-3-9", "question": "Name something thats cheap and greasy.", "answers": ["Burger (36)", "French fries (32)", "Chicken/wings (7)", "Oil/grease/lard (7)", "Pizza (5)", "Bacon (4)", "My ex (2)", "Taco (2)" ]},{ "date": "2024-3-10", "question": "What US state do you think has the most beautiful women?", "answers": ["California (53)", "Florida (15)", "Hawaii (12)", "New York (9)", "Indiana (2)", "New Jersey (2)", "Texas (2)", "Georgia (2)" ]},{ "date": "2024-3-11", "question": "Give me one word youd use to describe the last kiss your man gave you.", "answers": ["Warm (27)", "Sloppy (25)", "Wet (21)", "Quick (14)", "Sweet (5)", "Perfect (4)", "Happy (2)" ]},{ "date": "2024-3-12", "question": "Tell me something you have that has lasted longer than most of your relationships.", "answers": ["Shoes/clothes (17)", "Jewelry/watch (13)", "House (10)", "Car (9)", "Friendships (8)", "Pet (8)", "Children (5)", "Job (4)" ]},{ "date": "2024-3-13", "question": "Name a kind of hoop.", "answers": ["Hula-Hoop (74)", "Basketball hoop (18)", "Earring hoop (4)", "Embroidery hoop (3)" ]},{ "date": "2024-3-14", "question": "After you murder someone, name something specific you must quickly get rid of.", "answers": ["The weapon (58)", "The body (27)", "Blood (6)", "Fingerprints (5)", "My clothes/shoes (4)" ]},{ "date": "2024-3-15", "question": "Name an animal thats easy to imitate in charades.", "answers": ["Monkey/ape (32)", "Dog (21)", "Cat (16)", "Bird (14)", "Elephant (4)", "Kangaroo (4)", "Rabbit (4)" ]}]'
var answers = [];
var correct = []
var wrongGuess = 0;
var rightGuess = 0;
var score = 0;

var sleepSetTimeout_ctrl;

function sleep(ms) {
    clearInterval(sleepSetTimeout_ctrl);
    return new Promise(resolve => sleepSetTimeout_ctrl = setTimeout(resolve, ms));
}

window.addEventListener("load", readIn());


function readIn() {
    index = getAnswer();
    parsedAnswerData = JSON.parse(answerData);
    question = parsedAnswerData[index].question;
    answers = parsedAnswerData[index].answers;
    questionBox = document.getElementById("question");
    questionText = document.createElement("p");
    questionText.innerHTML = question;
    questionBox.appendChild(questionText);
    answerDiv = document.getElementById("answerBox");
    if (answers.length > 4) {
        answerDiv.classList.add("row");
        answerDiv.classList.add("mx-auto");
        answerColLeft = document.createElement("div");
        answerColLeft.classList.add("col");
        answerDiv.appendChild(answerColLeft);
        answerColRight = document.createElement("div");
        answerColRight.classList.add("col");
        answerColRight.setAttribute("id", "leftCol")
        answerDiv.appendChild(answerColRight);
    }
    for (let i = 0; i < answers.length; i++) {
      console.log(answers[i]);
        answerBox = document.createElement("div");
        answerBox = document.createElement("div");
        answerBox.classList.add("answer");
        answerBox.classList.add("container");
        answerBox.setAttribute("id", "answer" + i);
        if (answers.length > 4) {
            if (i >= answers.length / 2) {
                answerColRight.appendChild(answerBox);
            }
            else {
                answerColLeft.appendChild(answerBox);
            }
        }
        else {
            answerDiv.appendChild(answerBox);
        }
        correct[i] = "0";

    }

}

function getAnswer() {
    parsedAnswerData = JSON.parse(answerData);

    if ((window.location.href).includes("?")) {
        url = (window.location.href).split("?");
        answerDate = url[1];
        for (let i = 0; i < parsedAnswerData.length; i++) {
            if (answerDate == parsedAnswerData[i].date) {
                return i;
            }
        }
    }

    const date = new Date();

    for (let i = 0; i < parsedAnswerData.length; i++) {
        if ((date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate()) == parsedAnswerData[i].date) {
            return i;
        }
    }
}

async function guessFunction() {
    guessBtn = document.getElementById("guessBtn");
    if (!guessBtn.classList.contains("btnDisabled"))
    {
    let correctGuess = false;
    guess = document.getElementById("guess").value;
    console.log(guess);
    for (let i = 0; i < answers.length; i++) {
        if (correct[i] == "0") {
            currentAnswerBox = document.getElementById("answer" + i);
            currentAnswerBox.style.backgroundColor = "#8CB5FF";
            currentAnswerBox.style.outlineColor = "#3F84FF";
            currentAnswerBox.classList.add("glow");
            await sleep(1200);
            if (checkAnswer(document.getElementById("guess").value, answers[i])) {
                correctGuess = true;
                correct[i] = "1";
                score = (score + parseAnswerScore(answers[i]));
                currentAnswerBox.classList.add('flip');
                answerText = document.createElement("p");
                answerText.innerHTML = answers[i];
                currentAnswerBox.addEventListener("animationend", function (e) {
                    currentAnswerBox.classList.remove('flip');
                })
                await sleep(986);
                currentAnswerBox.appendChild(answerText);
                currentAnswerBox.classList.remove("glow");
                rightGuess++;
                break;
            }
            else if (correct[i] == "0") {
                currentAnswerBox.classList.remove("glow");
                currentAnswerBox.style.backgroundColor = "transparent";
                currentAnswerBox.style.outlineColor = "#1b1b1c";
            }
        }
    }
    document.getElementById("guess").value = "";
    if (rightGuess == answers.length) {
        gameWin();
    }
    if (correctGuess == false) {
        guessBtn.classList.add('shake');
        guessBtn.addEventListener("animationend", function (e) {
            guessBtn.classList.remove('shake');
        })
        wrongGuess++;
        wrongAttempt = document.getElementById("atmpt" + wrongGuess);
        wrongAttempt.style.backgroundColor = "#e37171"
        wrongAttempt.classList.add('shake');
        wrongAttempt.addEventListener("animationend", function (e) {
            wrongAttempt.classList.remove('shake');
        })
        if (wrongGuess == 3) {
            gameOver();
        }
    }
}

}

function parseAnswerScore(str)
{
    let strArr = str.split('(');
    str = strArr[1];
    str = str.substring(0, str.length-1);
    return parseInt(str);

}

function checkAnswer(guess, answer) {
    answrArr = answer.split("(");
    answer = answrArr[0].substring(0, answrArr[0].length-1);
    guess = guess.toLowerCase();
    answer = answer.toLowerCase();
    if (guess == answer) {
        return true;
    }
    else if (answer.includes("/")) {
        answrArr = answer.split("/");
        for (let i = 0; i < answrArr.length; i++) {
            if (guess == answrArr[i]) {
                return true;
            }
            else if (answrArr[i].includes(" ")) {
                answrArr2 = answer.split(" ");
                for (let j = 0; j < answrArr2.length; j++) {
                    if (guess == answrArr2[j]) {
                        return true;
                    }
                }
            }
            else if (guess.slice(-1) == "s" && answer + "s" == guess)
            {
                return true;
            }
            else if (answer.slice(-1) == "s" && guess + "s" == answer)
            {
                return true;
            }
        }
    }
    else if (answer.includes(" ")) {
        answrArr = answer.split(" ");
        for (let j = 0; j < answrArr.length; j++) {
            if (guess == answrArr[j]) {
                return true;
            }
            else if (guess.slice(-1) == "s" && answer + "s" == guess)
            {
                return true;
            }
            else if (answer.slice(-1) == "s" && guess + "s" == answer)
            {
                return true;
            }
        }
    }
    else if (guess.slice(-1) == "s" && answer + "s" == guess)
            {
                return true;
            }
            else if (answer.slice(-1) == "s" && guess + "s" == answer)
            {
                return true;
            }
    return false;
}

async function gameOver() {
    disableGuessing();
    for (let i = 0; i < answers.length; i++) {
        if (correct[i] == "0") {
            currentAnswerBox = document.getElementById("answer" + i);
            currentAnswerBox.style.backgroundColor = "#FFD143";
            currentAnswerBox.style.outlineColor = "#FFAC29";
            await sleep(1100);
            currentAnswerBox.classList.add('flip');
            answerText = document.createElement("p");
            answerText.innerHTML = answers[i];
            currentAnswerBox.addEventListener("animationend", function (e) {
                currentAnswerBox.classList.remove('flip');
            })
            await sleep(986);
            currentAnswerBox.appendChild(answerText);
        }
    }
    await sleep(500);
    displayEndScreen(false);
}

async function gameWin() {
    disableGuessing();
    await sleep(500);
    displayEndScreen(true);
}

function displayEndScreen(winLose) {
    body = document.getElementsByTagName("body");
    main = document.getElementById("main");
    main.classList.add("gameEnd");
    endScreenDiv = document.createElement("div");
    endScreenDiv.setAttribute("id", "endScreenDiv");
    body[0].appendChild(endScreenDiv);
    endScreenTitleText = document.createElement("h1");
    if (winLose)
    {
        endScreenTitleText.innerHTML = "Well Done!"
    }
    else {
        endScreenTitleText.innerHTML = "Too Bad..."
    }
    endScreenScoreTitle = document.createElement("h4");
    endScreenScoreTitle.innerHTML = "Score:";
    endScreenScore = document.createElement("h1");
    endScreenDiv.appendChild(endScreenTitleText);
    endScreenDiv.appendChild(endScreenScoreTitle);
    endScreenDiv.appendChild(endScreenScore);
    endScreenDiv.classList.add("drop");
    endScreenDiv.addEventListener("animationend", function (e) {
        endScreenDiv.classList.remove('drop');
        endScreenDiv.classList.add("float");
        countUp(endScreenScore); 
    })
    
}

async function countUp(num)
{
    num.style.color = "#FFD143"
    for (let i = 0; i <= score; i++)
    {
        num.style.filter = "saturate(" + i + "%)";
        num.innerHTML = i;
        await sleep(22)
    }
    if (score == 100)
    {
        confetti(); //code from https://codepen.io/bananascript/pen/EyZeWm
    }
}

function confetti() {
        var random = Math.random
    , cos = Math.cos
    , sin = Math.sin
    , PI = Math.PI
    , PI2 = PI * 2
    , timer = undefined
    , frame = undefined
    , confetti = [];

  var particles = 10
    , spread = 40
    , sizeMin = 3
    , sizeMax = 12 - sizeMin
    , eccentricity = 10
    , deviation = 100
    , dxThetaMin = -.1
    , dxThetaMax = -dxThetaMin - dxThetaMin
    , dyMin = .13
    , dyMax = .18
    , dThetaMin = .4
    , dThetaMax = .7 - dThetaMin;

  var colorThemes = [
    function() {
      return color(200 * random()|0, 200 * random()|0, 200 * random()|0);
    }, function() {
      var black = 200 * random()|0; return color(200, black, black);
    }, function() {
      var black = 200 * random()|0; return color(black, 200, black);
    }, function() {
      var black = 200 * random()|0; return color(black, black, 200);
    }, function() {
      return color(200, 100, 200 * random()|0);
    }, function() {
      return color(200 * random()|0, 200, 200);
    }, function() {
      var black = 256 * random()|0; return color(black, black, black);
    }, function() {
      return colorThemes[random() < .5 ? 1 : 2]();
    }, function() {
      return colorThemes[random() < .5 ? 3 : 5]();
    }, function() {
      return colorThemes[random() < .5 ? 2 : 4]();
    }
  ];
  function color(r, g, b) {
    return 'rgb(' + r + ',' + g + ',' + b + ')';
  }

  // Cosine interpolation
  function interpolation(a, b, t) {
    return (1-cos(PI*t))/2 * (b-a) + a;
  }

  // Create a 1D Maximal Poisson Disc over [0, 1]
  var radius = 1/eccentricity, radius2 = radius+radius;
  function createPoisson() {
    // domain is the set of points which are still available to pick from
    // D = union{ [d_i, d_i+1] | i is even }
    var domain = [radius, 1-radius], measure = 1-radius2, spline = [0, 1];
    while (measure) {
      var dart = measure * random(), i, l, interval, a, b, c, d;

      // Find where dart lies
      for (i = 0, l = domain.length, measure = 0; i < l; i += 2) {
        a = domain[i], b = domain[i+1], interval = b-a;
        if (dart < measure+interval) {
          spline.push(dart += a-measure);
          break;
        }
        measure += interval;
      }
      c = dart-radius, d = dart+radius;

      // Update the domain
      for (i = domain.length-1; i > 0; i -= 2) {
        l = i-1, a = domain[l], b = domain[i];
        // c---d          c---d  Do nothing
        //   c-----d  c-----d    Move interior
        //   c--------------d    Delete interval
        //         c--d          Split interval
        //       a------b
        if (a >= c && a < d)
          if (b > d) domain[l] = d; // Move interior (Left case)
          else domain.splice(l, 2); // Delete interval
        else if (a < c && b > c)
          if (b <= d) domain[i] = c; // Move interior (Right case)
          else domain.splice(i, 0, c, d); // Split interval
      }

      // Re-measure the domain
      for (i = 0, l = domain.length, measure = 0; i < l; i += 2)
        measure += domain[i+1]-domain[i];
    }

    return spline.sort();
  }

  // Create the overarching container
  var container = document.createElement('div');
  container.style.position = 'fixed';
  container.style.top      = '0';
  container.style.left     = '0';
  container.style.width    = '100%';
  container.style.height   = '0';
  container.style.overflow = 'visible';
  container.style.zIndex   = '9999';

  // Confetto constructor
  function Confetto(theme) {
    this.frame = 0;
    this.outer = document.createElement('div');
    this.inner = document.createElement('div');
    this.outer.appendChild(this.inner);

    var outerStyle = this.outer.style, innerStyle = this.inner.style;
    outerStyle.position = 'absolute';
    outerStyle.width  = (sizeMin + sizeMax * random()) + 'px';
    outerStyle.height = (sizeMin + sizeMax * random()) + 'px';
    innerStyle.width  = '100%';
    innerStyle.height = '100%';
    innerStyle.backgroundColor = theme();

    outerStyle.perspective = '50px';
    outerStyle.transform = 'rotate(' + (360 * random()) + 'deg)';
    this.axis = 'rotate3D(' +
      cos(360 * random()) + ',' +
      cos(360 * random()) + ',0,';
    this.theta = 360 * random();
    this.dTheta = dThetaMin + dThetaMax * random();
    innerStyle.transform = this.axis + this.theta + 'deg)';

    this.x = window.innerWidth * random();
    this.y = -deviation;
    this.dx = sin(dxThetaMin + dxThetaMax * random());
    this.dy = dyMin + dyMax * random();
    outerStyle.left = this.x + 'px';
    outerStyle.top  = this.y + 'px';

    // Create the periodic spline
    this.splineX = createPoisson();
    this.splineY = [];
    for (var i = 1, l = this.splineX.length-1; i < l; ++i)
      this.splineY[i] = deviation * random();
    this.splineY[0] = this.splineY[l] = deviation * random();

    this.update = function(height, delta) {
      this.frame += delta;
      this.x += this.dx * delta;
      this.y += this.dy * delta;
      this.theta += this.dTheta * delta;

      // Compute spline and convert to polar
      var phi = this.frame % 7777 / 7777, i = 0, j = 1;
      while (phi >= this.splineX[j]) i = j++;
      var rho = interpolation(
        this.splineY[i],
        this.splineY[j],
        (phi-this.splineX[i]) / (this.splineX[j]-this.splineX[i])
      );
      phi *= PI2;

      outerStyle.left = this.x + rho * cos(phi) + 'px';
      outerStyle.top  = this.y + rho * sin(phi) + 'px';
      innerStyle.transform = this.axis + this.theta + 'deg)';
      return this.y > height+deviation;
    };
  }

  function poof() {
    if (!frame) {
      // Append the container
      document.body.appendChild(container);

      // Add confetti
      var theme = colorThemes[0]
        , count = 0;
      (function addConfetto() {
        var confetto = new Confetto(theme);
        confetti.push(confetto);
        container.appendChild(confetto.outer);
        timer = setTimeout(addConfetto, spread * random());
      })(0);

      // Start the loop
      var prev = undefined;
      requestAnimationFrame(function loop(timestamp) {
        var delta = prev ? timestamp - prev : 0;
        prev = timestamp;
        var height = window.innerHeight;

        for (var i = confetti.length-1; i >= 0; --i) {
          if (confetti[i].update(height, delta)) {
            container.removeChild(confetti[i].outer);
            confetti.splice(i, 1);
          }
        }

        if (timer || confetti.length)
          return frame = requestAnimationFrame(loop);

        // Cleanup
        document.body.removeChild(container);
        frame = undefined;
      });
    }
  }

  poof();
    };


function disableGuessing() {
    guessBtn = document.getElementById("guessBtn");
    guessBtn.classList.add("btnDisabled");
    guess = document.getElementById("guess");
    guess.classList.add("textDisabled");
    guess.readOnly = true;
}

document.querySelector('#guess').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        event.preventDefault();
        guessFunction();
    }
});
